---
title: bcs) Session과 JWT
author: cotchan 
date: 2021-04-24 23:40:21 +0800 
categories: [ComputerScience, BCS]
tags: [bcs]
---

+ 아래 출처의 내용들을 바탕으로 작성한 내용입니다.    
+ 계속 업데이트 할 예정입니다.

---

## 1. 세션이란

+ **세션은 서버가 클라이언트를 식별하는데 사용하는 정보입니다.**
- 서버는 어딘가에 세션을 저장을 하는데 별다른 설정이 없었다면 서버 메모리에 저장을 합니다.
- ex. 유저 1번이 세션 1번에 저장되어 있다고 가정 
- 사용자는 쿠키를 통해서 session ID를 발급 받고, 추후 요청 시 sessionId를 들고 옵니다.
- 사용자가 쿠키를 주면 서버는 sesionID 1번을 메모리에서 뒤져서 알아냅니다.
- 문제는 세션이 서버 메모리에 저장 되므로 서버가 죽으면 데이터가 날라간다.

---

## 2. 이 문제를 해결하는 두 가지 방법

---

## 3. 세션 클러스터

+ 첫 번째 해결 방법 - 세션 클러스터

- **`세션 클러스터란`, 원래는 서버 메모리에만 세션이 존재했는데, 세션 클러스터라고 하는 어떤 공용 스토리지에 복제해놓는 것.**
- 그러면 다른 서버가 죽은 경우, 기존 서버는 세션 클러스터에서 이전에 죽은 서버의 정보를 가져옵니다.
- 이 세션 클러스터를 `보통 Redis로` 많이 만듭니다.

---

## 3-1. 세션 클러스터 장점

+ 장점 
  + **특정 Load에 장애가 생겨도 로그인 사용자들이 정상적으로 서비스 이용이 가능합니다.**

---

## 3-2. 세션 클러스터 단점

+ 단점 
  + 일단 뭔가가 생겼으니 관리 포인트가 증가하게 됩니다.
  + 만약에 Session Cluster에서 장애가 나면 대형장애로 이어집니다.
    - 기존에는 장애난 서버의 사용자만 문제가 됩니다.
    - 그러나 세션 클러스터에 문제가 생기면 모든 사용자가 재로그인을 하거나, 모든 사용자가 로그인 불가능할 수도 있습니다.
    - 이런 문제가 있어서 세션 클러스터는 절대 한 대로 만들지 않습니다. 여러 서버를 클러스터링으로 묶어서 제공합니다.

---

## 4. Stateless 아키텍쳐

+ **이 아키텍쳐의 대표주자가 `JWT`**

- HTTP는 근본적으로 `무상태 프로토콜`입니다.
  - 무상태성이란 사용자를 식별할 필요가 없음을 의미합니다.
  - Session을 써서 억지로 무상태성을 → 상태로 만든 것
  - 이걸 그냥 "Stateless 상태로 유지하자"라는 데서 출발했습니다.
  - 근데 문제는 무상태로 서비스를 만들라고 하면 만들 수 있는게 없습니다. 
  - 애초에 로그인이라는 개념이 없고, 매번 HTTP 요청이 발생할 때 마다 클라이언트는 항상 새로워집니다.
  - 그렇기 때문에 현실적으로 유의미한 서비스를 Stateless한 상태로 만들 수 없습니다.
  - 그래서 이런 무상태 프로토콜은 정적인 페이지에 적합합니다.
    - Static Resource 제공해주는 것. (ex. CDN 서비스)

---

## 4-1. JWT

- 상태를 남기는 Session을 남기지 않는 것 → JWT
- Json Web Token의 약자
  - **JWT 안에는 `클라이언트를 식별하는데 필요한 정보`를 담고 있습니다.**
  - 얘가 위변조 되지 않았다라는 걸 스스로 증명가능합니다.
  - **이 JWT는 보통 Client에서 서버로 전달할 때 `HTTP 헤더에 담아 전송`**
  - 서버쪽에서는 이 JWT를 클라이언트로부터 수신을 했을 때 이게 위변조 되지 않았다만 검증하면 됩니다. 다른 건 할 필요가 X
  - **`로그인이 정상처리가 되면` `서버는 JWT를 하나 발급 하고 이걸 응답으로` 내려줍니다.**
  - 클라이언트는 이 이후로부터 `HTTP HEADER에 JWT를 담아 요청`을 보냅니다
  - 서버는 헤더에 있는 JWT를 보고 클라이언트가 누군지 알 수 있습니다.
  - 로그인 이후에는 `요청에 반드시 JWT가 들어가야` 합니다.
  - base64 기법을 통해 인코딩 (암호화 키가 필요한 게 X)
      - **그러므로 JWT에는 민감한 정보가 담기면 안됩니다.**
          - 사용자 정보가 절대 JWT에 포함되면 안됩니다.
          - 그냥 `PK`(sequence number) 정도만 넘겨줍니다.
          - 이 사용자가 가지고 있는 권한, 언제 이 토큰이 발급되었는지, 언제 만료되는지 이정도만 들어갑니다.
          - `header`는 크게 신경쓸 게 없음
          - `Payload`는 사용자가 정 의한 데이터 부분
          - `Signature` 부분이 `payload가 위변조 되지 않았다`고 증명하는 부분
              - 최초로 서버에서 만들었고, 악의적인 공격에 의해 위변조 되지 않았다는 것을 의미합니다.

---

+ 출처

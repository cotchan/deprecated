---
title: JPA) JPA 기본 개념
author: cotchan 
date: 2021-01-14 00:00:21 +0800 
categories: [JPA, JPA_Basic]
tags: [jpa] 
---

## 1. JPA가 동작하는 위치

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-1.png)

---

## 2. JPA 동작 - 저장

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-2.png)

---

## 3. JPA 동작- 조회

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-3.png)

---

## 4. JPA CRUD

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-4.png)

---

## 5. JPA의 성능 최적화 기능

---

## 5-1. 1차 캐시와 동일성 보장

1. **같은 트랜잭션 안에서는 같은 엔티티를 반환** - 약간의 조회 성능 향상
2. DB Isolation Level이 `Read Commit`이어도 애플리케이션에서 `Repeatable Read`를 보장

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-5.png)

+ 1. sql이 날라가서 m1을 가져옵니다.
+ 2. 두 번째로 동일한 트랜잭션에서 이전의 PK 값이 들어가면 `메모리에 있는` `m1을` ` 그대로` `리턴`해줍니다.
  + 그래서 SQL은 한 번만 실행됩니다.


---

## 5-2. 트랜잭션을 지원하는 쓰기 지연 - INSERT


![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-6.png)

---

## 5-3. 지연 로딩과 즉시 로딩

+ **`JPA의 옵션` 설정으로 지연 로딩과 즉시 로딩을 사용할 수 있습니다.**

---

+ **`지연 로딩`**
  1. 멤버 객체를 꺼낼 때는 멤버 객체만 우선 가지고 옵니다.(`select` 쿼리)
  2. 그런데 team 객체의 어떤 값을 건드릴 때 (`실제 team 값이 필요할 때`) 이 때 JPA가 DB에 team에 대한 쿼리를 날립니다. 
  3. 그래서 그 객체에 대한 값을 가지고 와서 데이터를 채우고 채워진 결과인 `teamName`을 반환해줍니다.

  + 지연 로딩의 장점은 쿼리가 두 번 나간다는 점입니다.
    + 그러므로 member를 쓸 때는 거의 member 밖에 안 쓰고 team은 어쩌다가 쓴다면 지연 로딩 전략이 더 낫습니다.
  

+ **즉시 로딩**
  + 개발을 해보니 99% member를 조회하면 team을 같이 씁니다.
    + 그래서 member를 조회할 때 무조건 team을 한 방 쿼리로 같이 가져오는 게 이득입니다.
   

![Desktop View](/assets/img/post/jpa/2021-01-14-jpa-intro-7.png)

---

+ 출처
    + [자바 ORM 표준 JPA 프로그래밍 - 기본편](https://www.inflearn.com/course/ORM-JPA-Basic)
